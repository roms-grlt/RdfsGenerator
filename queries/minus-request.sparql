# Requête avec double exclusion (MINUS) : films Amazon bien notés
# Exclut : les films sur Netflix, les contenus courts IMDB (< 60 min)
# Trouve du contenu long-format exclusif à Amazon
PREFIX unified: <http://example.org/unified/>
PREFIX amazon: <http://example.org/amazon/>
PREFIX netflix: <http://example.org/netflix/>
PREFIX imdb: <http://example.org/imdb/>

SELECT ?title ?amazonRating ?releaseYear ?format ?mpaaRating
       (GROUP_CONCAT(DISTINCT ?imdbGenre; separator=", ") as ?genres)
WHERE {
  # Films Amazon bien notés
  ?amazonFilm a amazon:AmazonFilm ;
              unified:title ?title ;
              amazon:rating ?amazonRating .

  OPTIONAL { ?amazonFilm amazon:releaseYear ?releaseYear }
  OPTIONAL { ?amazonFilm amazon:format ?format }
  OPTIONAL { ?amazonFilm amazon:mpaaRating ?mpaaRating }

  # Enrichissement avec genres IMDB si disponibles
  OPTIONAL {
    ?imdbFilm a imdb:ImdbFilm ;
              unified:title ?title ;
              imdb:genre ?imdbGenre .
  }

  # Exclusion 1 : enlever les films qui existent aussi sur Netflix
  MINUS {
    ?netflixFilm a netflix:NetflixFilm ;
                 unified:title ?title .
  }

  # Exclusion 2 : enlever les contenus courts (< 60 min) selon IMDB
  MINUS {
    ?shortContent a imdb:ImdbFilm ;
                  unified:title ?title ;
                  imdb:duration ?duration .
    FILTER(?duration < 60)
  }

  FILTER(?amazonRating >= 4.7)
}
GROUP BY ?title ?amazonRating ?releaseYear ?format ?mpaaRating
ORDER BY DESC(?amazonRating) ?title
LIMIT 20